概要
====
このページではSgry.IniというINIファイル形式を扱うC#のクラスを公開しています。非
常に制約の緩いzlibライセンスでの配布であること、1ソースファイルで記述されている
ことから、既存プロジェクトへの組み込みも簡単に行えると思います。

INI形式について
===============
このライブラリが扱うINI形式について、簡単に説明をしておきます。INI形式は厳密な
フォーマット仕様こそ存在しませんが、非常に広くに使われているファイルフォーマッ
トです。INI形式では、「AはBである」という情報を次のような形式のテキストで表しま
す。

    A=B

この一行で「イコール記号の左側の値が、イコール記号の右側の値である」という情報
になります。たとえば「名前が山本である」という情報は次のようになります。

名前=山本
なおこれは必ず一行に収まっている必要があり、改行を含んだデータを書き込むことは
できません。

このライブラリでは、こうした一つの情報をINI形式の「エントリー」と呼びます。また
イコール記号の左側の値を「エントリー名」、イコール記号の右側の値を「エントリー
値」または単に「値」と呼びます。INI形式とは、基本的にはエントリーが集まったもの
になります。

さて、当然ですが、この形式ですと同じエントリー名のエントリーを複数定義すること
はできません。そこで複数のエントリーをまとめてグループ化する仕組みが使われてい
ます。まず具体例を先に挙げます。

    [User1]
    FamilyName=YAMAMOTO
    FirstName=Suguru
    Sex=Male
    [User2]
    FamilyName=YAMADA
    FirstName=Taro
    Sex=Male

ここで大カッコで囲われた見出しのような行があることに気づくと思いますが、実際に
それらは見出しの意味を持っています。つまり、ある見出しの行から後ろにあるエント
リーは、その見出しのセクション（章）で書かれていると言えます。そして次の見出し
の行が見つかったら、その後ろにあるエントリーからは新しく見つかった見出しのセク
ション（章）で書かれていると言えます。

このライブラリでは、見出しの意味を持つ行を「セクション開始行」と呼び、セクショ
ン開始行から次のセクション開始行までの区間を「セクション」と呼びます。またセク
ション開始行の大カッコの中身を、そこから始まるセクションの名前として使用しま
す。したがって先ほどの例でいえばセクションUser1のFirstNameはSuguruであり、セク
ションUser2のFirstNameはTaroとなります。

機能
====
ファイルやストリームからデータを読み出す
----------------------------------------
ファイルやメモリなどにあるINIデータを解析して内容をロードする場合はLoadメソッド
を使います。またINIデータのロード元としてSystem.IO.TextReaderを、INIデータの出
力先としてSystem.IO.TextWriterを指定できるため、ファイルだけでなくメモリ上の
バッファなどに対しても読み書き可能です。ごく単純な例を次に示します。

    Ini ini = new Ini();
    ini.Load( "data.ini", Encoding.UTF8 );

値の取り出し
------------
ロードしたデータの読み出しはGetメソッドを使います。GetメソッドではString型、
Bool型、Double型といった基本的なデータを直接扱えます。次に例を示します。

    /* ファイル data.ini の内容:
    [Profile]
    Name=Suguru
    IsGeek=True
    */
    
    // ファイルの内容をロード
    Ini ini = new Ini();
    ini.Load( "data.ini" );
    
    // データを取り出す
    ini.Get( "Profile", "Name", null ); // "Suguru" が返る
    ini.Get( "Profile", "IsGeek", false ); // true が返る
    ini.Get( "Profile", "Age", 20 ); // Age は INI 中に無いので 20 が返る

Getメソッドは、Iniファイルの主な用途が設定ファイルであることを考えて第3引数で
「デフォルト値」を指定できるようになっています。これによって「値が見つからなけ
ればデフォルト値を設定する」という設定読み出し処理で頻繁に出てくる面倒なコー
ディングの手間が軽減される・・・かもしれません。

なお数値の取得用には専用のメソッドGetIntを用意しています。もちろんGetメソッドで
も数値は取得できますが、GetIntは数値の取得と同時に範囲チェックも行ってくれます。
設定項目の場合、たとえば日付のデータは1以上31以下でなければいけませんし、ウィン
ドウの幅は正の数でなければいけません。こうしたデータを読み出す場合にGetIntを使
えば「許容する最小値と最大値」を指定できるので、読み出した後でチェックする手間
を省略できます。

ちなみに、厳密にはGetメソッドには文字列用のGetメソッドと値型を汎用的に扱う
Get<T>メソッドがありますが、ただ普通に使う場合はGetという2つのメソッドがあるこ
とを意識する必要は無いはずです。システム標準の基本的な型でない独自の型などを使
う場合は若干話がややこしくなるかもしれませんので注意してください。

値の変更や追加
--------------
INIデータの内容を変更する場合はSetメソッドを使います。指定したセクションの、指
定したエントリ名を持った値がすでに存在する場合、その値はSetメソッドで指定した値
に書き換えられます。逆に存在しない場合、新たに指定したエントリが作成されて、そ
こに指定した値が設定されます。

値として使うオブジェクトの型は、何でもOKです。内部でそのオブジェクトのToString
メソッドを呼び出して、その結果文字列を使うからです。

値の削除
--------
INIデータ中の値を削除するにはRemoveメソッドを使います。Removeメソッドには削除し
たい値（エントリー）があるセクションの名前とエントリー名を指定します。

ファイルやストリームにデータを保存
----------------------------------
INIデータをファイルなどのストリームに保存するにはSaveメソッドを使います。Saveメ
ソッドにはTextWriterを与えるか、ファイルパスを与えます。次に例を示します。

    // data.ini というファイルに UTF-8 で保存
    ini.Save( "data.ini", Encoding.UTF8 );
    
    // メモリ上のバッファ(StringBuilder)に INI 形式テキストとして書き込む
    StringBuilder buf = new StringBuilder();
    StringWriter writer = new StringWriter( buf );
    ini.Save( writer );
    buf.ToString() // INI 形式テキストが返る
